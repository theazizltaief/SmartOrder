<%= form_with model: [:admin, plat], local: true do |f| %>
  <% if plat.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(plat.errors.count, "erreur") %> :</h4>
      <ul style="margin: 0; padding-left: 1.5rem;">
        <% plat.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :nom, "Nom du plat", class: "form-label" %>
    <%= f.text_field :nom, class: "form-control", placeholder: "Ex: Burger Classique, Coca-Cola...", required: true %>
  </div>

  <div class="form-group">
    <%= f.label :type_de_plat, "Type", class: "form-label" %>
    <%= f.select :type_de_plat,
        options_for_select([['🍽️ Plat', 'Plat'], ['🥤 Boisson', 'Boisson']], plat.type_de_plat),
        { prompt: "Choisir un type..." }, { class: "form-control", required: true } %>
  </div>

  <div class="form-group">
    <%= f.label :prix_en_centimes, "Prix (en millimes)", class: "form-label" %>
    <div style="display: flex; align-items: center; gap: 0.5rem;">
      <%= f.number_field :prix_en_centimes, class: "form-control", placeholder: "Ex: 1500 pour 1.500 DT", min: 0, step: 1, required: true, style: "flex: 1;" %>
      <span style="color: #7f8c8d; font-size: 0.9rem;">millimes</span>
    </div>
    <% if plat.prix_en_centimes.present? %>
      <div style="margin-top: 0.5rem; padding: 0.5rem; background: #e8f5e8; border-radius: 5px;">
        <strong>Aperçu :</strong> <%= format_price_dt(plat.prix_en_centimes) %>
      </div>
    <% end %>
  </div>

  <div class="form-group">
    <%= f.label :description, "Description", class: "form-label" %>
    <%= f.text_area :description, class: "form-control", rows: 4, placeholder: "Décrivez les ingrédients, la préparation...", required: true %>
  </div>

  <!-- Suggestions via datalist -->
  <datalist id="sauces_suggestions">
    <option value="ketchup"></option>
    <option value="mayonnaise"></option>
    <option value="harissa"></option>
  </datalist>
  <datalist id="legumes_suggestions">
    <option value="oignon"></option>
    <option value="tomate"></option>
    <option value="laitue"></option>
  </datalist>
  <datalist id="supplements_suggestions">
    <option value="frites"></option>
    <option value="viande hachée"></option>
  </datalist>

  <!-- Sauces -->
  <div class="form-group" data-controller="tags" data-tags-name-value="plat[sauces][]">
    <%= f.label :sauces, "Sauces" %>
    <input type="text" class="form-control" data-tags-target="input" list="sauces_suggestions" placeholder="Tapez et Entrée (ou virgule)" data-action="keydown->tags#keydown" />
    <div data-tags-target="container" class="tags-container">
      <% plat.sauces.each do |tag| %>
        <span class="tag">
          <%= tag %>
          <button type="button" data-action="click->tags#remove" data-tag="<%= tag %>">&times;</button>
        </span>
        <%= hidden_field_tag "plat[sauces][]", tag %>
      <% end %>
    </div>
  </div>

  <!-- Légumes -->
  <div class="form-group" data-controller="tags" data-tags-name-value="plat[legumes][]">
    <%= f.label :legumes, "Légumes" %>
    <input type="text" class="form-control" data-tags-target="input" list="legumes_suggestions" placeholder="Tapez et Entrée (ou virgule)" data-action="keydown->tags#keydown" />
    <div data-tags-target="container" class="tags-container">
      <% plat.legumes.each do |tag| %>
        <span class="tag">
          <%= tag %>
          <button type="button" data-action="click->tags#remove" data-tag="<%= tag %>">&times;</button>
        </span>
        <%= hidden_field_tag "plat[legumes][]", tag %>
      <% end %>
    </div>
  </div>

  <!-- Suppléments -->
  <div class="form-group" data-controller="tags" data-tags-name-value="plat[supplements][]">
    <%= f.label :supplements, "Suppléments" %>
    <input type="text" class="form-control" data-tags-target="input" list="supplements_suggestions" placeholder="Tapez et Entrée (ou virgule)" data-action="keydown->tags#keydown" />
    <div data-tags-target="container" class="tags-container">
      <% plat.supplements.each do |tag| %>
        <span class="tag">
          <%= tag %>
          <button type="button" data-action="click->tags#remove" data-tag="<%= tag %>">&times;</button>
        </span>
        <%= hidden_field_tag "plat[supplements][]", tag %>
      <% end %>
    </div>
  </div>

  <div class="form-group">
    <%= f.label :photo, "Photo", class: "form-label" %>
    <%= f.file_field :photo, class: "form-control", accept: "image/*" %>
    <% if plat.photo.attached? %>
      <div style="margin-top: 1rem;">
        <p style="color: #28a745; font-weight: 600;">📷 Photo actuelle :</p>
        <%= image_tag plat.photo, style: "width: 150px; height: 100px; object-fit: cover; border-radius: 8px; border: 2px solid #e9ecef;" %>
      </div>
    <% end %>
  </div>

  <div style="display: flex; gap: 1rem; margin-top: 2rem;">
    <% submit_text = plat.persisted? ? "💾 Mettre à jour" : "➕ Créer le plat" %>
    <%= f.submit submit_text, class: "btn btn-success", style: "flex: 1;" %>
    <%= link_to "Annuler", admin_plats_path, class: "btn btn-secondary" %>
  </div>
<% end %>
